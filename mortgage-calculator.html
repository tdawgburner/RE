<script>
  const taxRates = {
    "Washington, DC": 0.85,
    "New York, NY": 1.68,
    "Los Angeles, CA": 1.25,
    "Chicago, IL": 2.3,
    "Miami, FL": 1.0,
    "Austin, TX": 1.6,
    "Phoenix, AZ": 0.72,
    "Atlanta, GA": 0.95,
    "Denver, CO": 0.57,
    "Seattle, WA": 0.93
  };

  function updateLoanAmount() {
    const price = parseFloat(document.getElementById("homePrice").value) || 0;
    const down = parseFloat(document.getElementById("downPayment").value) || 0;
    const loan = Math.max(price - down, 0);
    document.getElementById("loanAmount").value = loan.toFixed(2);
  }

  document.getElementById("homePrice").addEventListener("input", updateLoanAmount);
  document.getElementById("downPayment").addEventListener("input", updateLoanAmount);

  function calculateMortgage() {
    const loanAmount = parseFloat(document.getElementById("loanAmount").value);
    const interestRate = parseFloat(document.getElementById("interestRate").value) / 100;
    const loanTerm = parseFloat(document.getElementById("loanTerm").value);
    const selectedCity = document.getElementById("city").value;
    const homePrice = parseFloat(document.getElementById("homePrice").value);

    if (!loanAmount || !interestRate || !loanTerm) {
      alert("Please fill out home price, down payment, interest rate, and loan term.");
      return;
    }

    const monthlyInterest = interestRate / 12;
    const numberOfPayments = loanTerm * 12;
    const baseMonthly = (loanAmount * monthlyInterest) / (1 - Math.pow(1 + monthlyInterest, -numberOfPayments));

    let taxMonthly = 0;
    if (selectedCity && taxRates[selectedCity]) {
      const annualTax = homePrice * (taxRates[selectedCity] / 100);
      taxMonthly = annualTax / 12;
    }

    const totalMonthly = baseMonthly + taxMonthly;

    document.getElementById("resultText").innerText = `Monthly Payment: $${totalMonthly.toFixed(2)} ${taxMonthly > 0 ? '(incl. est. property tax)' : ''}`;

    // Generate amortization table for 72 months
    generateAmortizationTable(loanAmount, monthlyInterest, baseMonthly, taxMonthly);
  }

  function generateAmortizationTable(principal, monthlyRate, monthlyPayment, taxMonthly) {
    const tableContainerId = "amortizationTable";
    let table = document.getElementById(tableContainerId);

    if (!table) {
      table = document.createElement("table");
      table.id = tableContainerId;
      table.style.marginTop = "30px";
      table.style.width = "100%";
      table.style.borderCollapse = "collapse";
      table.innerHTML = `
        <thead>
          <tr style="background-color:#00aaff; color:white;">
            <th style="padding:10px; border:1px solid #ddd;">Month</th>
            <th style="padding:10px; border:1px solid #ddd;">Principal</th>
            <th style="padding:10px; border:1px solid #ddd;">Interest</th>
            <th style="padding:10px; border:1px solid #ddd;">Property Tax</th>
          </tr>
        </thead>
        <tbody></tbody>
      `;
      document.querySelector(".container").appendChild(table);
    }

    const tbody = table.querySelector("tbody");
    tbody.innerHTML = "";

    let balance = principal;

    for (let month = 1; month <= 72; month++) {
      const interest = balance * monthlyRate;
      const principalPaid = monthlyPayment - interest;
      balance -= principalPaid;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td style="padding:8px; border:1px solid #ddd; text-align:center;">${month}</td>
        <td style="padding:8px; border:1px solid #ddd; text-align:right;">$${principalPaid.toFixed(2)}</td>
        <td style="padding:8px; border:1px solid #ddd; text-align:right;">$${interest.toFixed(2)}</td>
        <td style="padding:8px; border:1px solid #ddd; text-align:right;">$${taxMonthly.toFixed(2)}</td>
      `;
      tbody.appendChild(row);
    }
  }
</script>
